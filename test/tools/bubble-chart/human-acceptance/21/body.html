<body>
<div id="chartInfo"></div>
<div id="chartFooter"></div>
<script src="scripts/vizabi.js"></script>
<div id="chart-1"></div>
<script>
    function initialize() {
        var renderDiv = "chart-1";
        var chartState;
        var app;

        if (window.history.state === null) {
            var URL = window.location.href.toString();
            // When a new tab is opened
            if (URL.indexOf("#?") !== -1) {
                console.log("URL contains the character");
                var model = JSON.parse(URL.substr(URL.indexOf("#?") + 2, URL.length));
                history.pushState(model, "", "#?" + JSON.stringify(model));
                chartState = model;
            }
            else {
                chartState = {
                    isInteractive: true,
                    dataPath: "data/",
                    year: 2011,
                    fileFormat: "multiCSV",
                    category: ["country"],
                    xAxisScale: "log",
                    //xAxisTickValues: [500, 1000, 1500, 2000, 3000, 5000, 7000, 10000, 15000, 30000, 40000, 60000, 80000 ],
                    xAxisTickValues : [500, 5000, 50000],
                    language : "en",
                    speed: 0.1,
                    minXValue: 1000,
                    maxXValue: 5000000,
                    autoZoom: true
                };
            }
        }
        else {
            chartState = window.history.state;
        }

        app = new vizabi.bubbleChart(renderDiv, chartState);

        app.registerStateBindCallback(function(model) {
            var currentState = window.history.state;

            if (!currentState) {
                history.pushState(model, "", "#?" + JSON.stringify(model));
            }
            else {
                history.replaceState(model, "", "#?" + JSON.stringify(model));
            }
        });

        var loadSubnational = function () {
            app.setState({category: ["country","adm1"], isSplitMode: true});
        };

        var unloadSubnational = function() {
            app.setState({category: ["country"]});
        };

        var reloadIMR = function () {
            app.setState({yIndicator: "imr"});
        };
    }

    vizabi.ready(initialize);

</script>
</body>
</html>